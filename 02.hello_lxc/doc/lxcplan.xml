<lxcplan>
  <hosts>
    <host hostname="localhost">
      <bridges>
        <bridge name="br.ctl">
          <ipaddress>
            <ipv4>10.76.0.200/24</ipv4>
          </ipaddress>
        </bridge>
      </bridges>

      <containers>
        <container lxc_name="node-${'%03d' % lxc_index}" lxc_indices="1-2">
          <parameters>
            <parameter name="lxc.tty" value="1"/>
            <parameter name="lxc.pts" value="128"/>
            <parameter name="lxc.console" value="none"/>
            <parameter name="lxc.mount.auto" value="proc sys"/>
          </parameters>
          <interfaces>
            <interface bridge="br.ctl" hosts_entry_ipv4="${lxc_name}">
              <parameter name="lxc.network.type" value="veth"/>
              <parameter name="lxc.network.name" value="backchan0"/>
              <parameter name="lxc.network.flags" value="up"/>
              <parameter name="lxc.network.ipv4" value="10.76.0.${lxc_index}/16"/>
              <parameter name="lxc.network.veth.pair" value="veth.ctl.${lxc_index}"/>
            </interface>
          </interfaces>
          <initscript>#!/bin/bash

# make node for tun device
mkdir /dev/net
mknod /dev/net/tun c 10 200

pidfile="${lxc_directory}/var/run/sshd.pid"
/usr/sbin/sshd -o "PidFile=$pidfile" -o "PermitRootLogin=yes" -o "PasswordAuthentication=no" -o "HostKeyAlgorithms=ssh-rsa"
          </initscript>
        </container>
      </containers>
    </host>
  </hosts>
</lxcplan>
